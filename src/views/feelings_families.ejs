<html lang="en">
<%- include('./partials/head.ejs') %>
    <body>
        <nav class="mouseM">
        <ul class="header">
            <li><a>THE THINKING SPACE</a></li>
            <li class="home" style="float: right;"><a href="/"><i class="fa-solid fa-house"></i></a></li>
        </ul>
        </nav>

        <div class="container mouseM" id="gameCanvas">  
            <h1 class="colouredText">Feeling Families</h1>
            <img class="logo" id="basketImage" src="images/basket.jpg" alt="basket image" width="1" height="1">
            <!--need to centre this button-->
            <button onclick="startGame()" class="button" id="startButton">Start Game!</button>
            <!--add game instructions here-->
            

            
            
        </div>

        <!-- Footer with logo and motto aligned to left and right -->
        <footer class="footer">
        <img class="logo" src="images/logo.png" alt="Raymer Enterprises Ltd" width="212" height="104">
        <span class="motto mouseM">With emotional health in mind</span>
        </footer>

        <script>
            var word1;
            let rightPressed = false;
            let leftPressed = false;

            function startGame() {
                gameArea.start();
                // create components for words
                //do a for loop for this, make an array of all the words, random starting x values
                // may need an attribute for whether they are in the family or not
                word1 = new wordComponent("angry", 10, 80);
                basket = new basket();
            }
            var gameArea = {
                // create canvas, remove start game button and place canvas in container
                canvas : document.createElement("canvas"),
                start : function() {
                    this.canvas.width = 480;
                    this.canvas.height = 270;
                    this.context = this.canvas.getContext("2d");
                    this.context.font = "20px Comic Sans";
                    document.getElementById("startButton").remove()
                    document.getElementById('gameCanvas').appendChild(this.canvas);
                    //runs updateGameArea every 20ms
                    this.interval = setInterval(updateGameArea, 20);
                    // runs key up/down handler when the left/right arrows are pressed
                    document.addEventListener("keydown", keyDownHandler, false);
                    document.addEventListener("keyup", keyUpHandler, false);
                },
                clear : function() {
                    this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
                }
                }
            
                // create component for each word
                function wordComponent(word, x, y) {
                    this.word = word
                    this.x = x
                    this.y = y
                    this.update = function(){
                        ctx = gameArea.context;
                        ctx.fillText(this.word, this.x, this.y);
                        }   
                }

                //create a basket that the words will fall into
                // this needs to move left and right with the mouse
                function basket() {
                    this.x = 20
                    // array of wordComponents which have hit the basket
                    // when wordComponent hits the basket, it gets added to this array
                    // when basket gets moved, these words move too
                    this.words = []

                    // need to make this a png
                    const image = document.getElementById("basketImage")
                    this.update = function(){
                        gameArea.context.drawImage(image, this.x, 150,100, 100)
                    }
                }
                // handles when keys are continuosly pressed or not
                function keyDownHandler(e) {
                    if (e.key === "Right" || e.key === "ArrowRight") {
                        rightPressed = true;
                    } else if (e.key === "Left" || e.key === "ArrowLeft") {
                        leftPressed = true;
                    }
                }
                function keyUpHandler(e) {
                    if (e.key === "Right" || e.key === "ArrowRight") {
                        rightPressed = false;
                    } else if (e.key === "Left" || e.key === "ArrowLeft") {
                        leftPressed = false;
                    }
                }

                // update until all words have fallen
                // if word falls in basket, it stays, otherwise it falls out of the canvas
                // at the end of the game, see what words are in the basket, see if you go up a level

                function updateGameArea() {
                    gameArea.clear();
                    if(word1.y <= 260){
                        word1.y += 1;
                    }
                    word1.update();
                    // move the basket with arrows, only up to boundaries of the canvas
                    if (rightPressed) {
                        basket.x = Math.min(basket.x + 5, gameArea.canvas.width - 100);
                    } else if (leftPressed) {
                        basket.x = Math.max(basket.x - 5, 0);
                    }
                    basket.update();
                }

        </script>

    </body>

</html>
