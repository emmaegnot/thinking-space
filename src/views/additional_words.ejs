<html lang="en">
<%- include('./partials/head') %>
 <body>
    <nav class="mouseM">
      <ul class="header">
        <li><a>THE THINKING SPACE</a></li>
        <li class="home" style="float: right;"><a href="/"><i class="fa-solid fa-house"></i></a></li>
      </ul>
    </nav>
    <div class="container mouseM">
      <form id="additionalForm" method="post">
        <h1 class="colouredText">Choose some more words...</h1>
        <div class="word-container">
          <div class="selected-words left-words">
            <!-- Selected words on the left will appear here -->
          </div>

          <div align="center">
            <img class="chosen-shape" src="<%= filepath %>" />
          </div>

          <div class="selected-words right-words">
            <!-- Selected words on the right will appear here -->
          </div>
        </div>

        <!-- Word Selection Items -->
        <div class="word-selection">
          <div class="word-item">
            <label>
              <input type="checkbox" name="words" value="<%= wordList[0] %>" onchange="updateSelectedWords()" hidden>
              <%= wordList[0] %>
            </label>
          </div>
          <div class="word-item">
            <label>
              <input type="checkbox" name="words" value="<%= wordList[1] %>" onchange="updateSelectedWords()" hidden>
              <%= wordList[1] %>
            </label>
          </div>
          <div class="word-item">
            <label>
              <input type="checkbox" name="words" value="<%= wordList[2] %>" onchange="updateSelectedWords()" hidden>
              <%= wordList[2] %>
            </label>
          </div>
          <div class="word-item">
            <label>
              <input type="checkbox" name="words" value="<%= wordList[3] %>" onchange="updateSelectedWords()" hidden>
              <%= wordList[3] %>
            </label>
          </div>
          <div class="word-item">
            <label>
              <input type="checkbox" name="words" value="<%= wordList[4] %>" onchange="updateSelectedWords()" hidden>
              <%= wordList[4] %>
            </label>
          </div>
          <div class="word-item">
            <label>
              <input type="checkbox" name="words" value="<%= wordList[5] %>" onchange="updateSelectedWords()" hidden>
              <%= wordList[5] %>
            </label>
          </div>
          <div class="word-item">
            <label>
              <input type="checkbox" name="words" value="<%= wordList[6] %>" onchange="updateSelectedWords()" hidden>
              <%= wordList[6] %>
            </label>
          </div>
          <div class="word-item">
            <label>
              <input type="checkbox" name="words" value="<%= wordList[7] %>" onchange="updateSelectedWords()" hidden>
              <%= wordList[7] %>
            </label>
          </div>
        </div>

        <div class="button-div" align="center">
          <button type="button" id="backButton">BACK</button>
          <button type="button" id="nextButton">NEXT</button>
        </div>
      </form>
    </div>
    <footer class="footer">
      <img class="logo" src="images/logo.png" alt="Raymer Enterprises Ltd">
      <span class="motto mouseM">With emotional health in mind</span>
    </footer>

    <script>
      const colour = sessionStorage.getItem('selectedColour')
      document.body.style.setProperty('--main-colour', colour);
      if(colour === "black"){
        document.body.style.setProperty('--add-colour', "grey");
      }
      const image = document.querySelector('.chosen-shape')
      image.style.backgroundColor = colour

      function updateSelectedWords() {
        // Get all checked word items
        const selectedWords = Array.from(document.querySelectorAll('input[name="words"]:checked')).map(el => el.value);
        const checkboxes = document.querySelectorAll('input[name="words"]');
        
        checkboxes.forEach(checkbox => {
            const wordItem = checkbox.closest('.word-item');
            if (checkbox.checked) {
                wordItem.classList.add('selected'); // Add highlight
            } else {
                wordItem.classList.remove('selected'); // Remove highlight
            }
        });

        // Save the selected words as a comma-separated string in sessionStorage
        sessionStorage.setItem('selectedWords', selectedWords.join(','));

        // Clear and update the left and right word containers
        const leftWordsContainer = document.querySelector('.left-words');
        const rightWordsContainer = document.querySelector('.right-words');
        leftWordsContainer.innerHTML = '';
        rightWordsContainer.innerHTML = '';

        selectedWords.forEach((word, index) => {
          const wordElement = document.createElement('div');
          wordElement.className = 'selected-word';
          wordElement.textContent = word;
          // Add to left or right container based on index
          if (index % 2 === 0) {
            leftWordsContainer.appendChild(wordElement);
          } else {
            rightWordsContainer.appendChild(wordElement);
          }
        });
      }
        
      document.addEventListener('DOMContentLoaded', () => {
        const selectedWordsString = sessionStorage.getItem('selectedWords') || '';
        const selectedWords = selectedWordsString.split(',');
        selectedWords.forEach(word => {
          const checkbox = document.querySelector(`input[name="words"][value="${word}"]`);
          if (checkbox) {
            checkbox.checked = true;
          }
        });
        updateSelectedWords();
      });

      document.getElementById('backButton').addEventListener('click', function() {
          const form = document.getElementById('additionalForm');
          form.action = '/previous-additional';
          form.submit();
      });
      document.getElementById('nextButton').addEventListener('click', function() {
          const form = document.getElementById('additionalForm');
          form.action = '/next-additional';
          form.submit();
      });
      
    
    </script>
    <style>
      .word-selection {
        display: flex;
        flex-wrap: wrap; 
        justify-content: center; 
        gap: 15px;
        max-width: 80%; 
        margin: 20px auto; 
      }
      .word-item {
        display: flex;
        align-items: center;
        justify-content: center;
        background: white;
        border-radius: 100px;
        padding: 10px 15px;
        font-size: 1.3em;
        box-shadow: 2px 2px 10px rgba(0,0,0,0.2);
        cursor: pointer;
      }

      .word-item.selected {
        background-color: lightgreen; /* Change to your preferred color */
        
      }

      .word-item label {
        display: flex;
        align-items: center;
        gap: 8px;
      }
      body {
        --main-colour: black; 
        --add-colour: black;
      }
      .left-words, .right-words{
        width: 40%;
        color: var(--main-colour);
        text-shadow: 
        -1px -1px 0 var(--add-colour),  
        1px -1px 0 var(--add-colour),
        -1px  1px 0 var(--add-colour),
        1px  1px 0 var(--add-colour);
      }
    </style>
 </body>
</html>
